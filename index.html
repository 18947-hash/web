<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>แม่สูตรคูณ 1–1000 + Scientific Calculator (ธีม สมัยใหม่)</title>
  <style>
    /* Modern Theme: Clean & Minimal */
    :root{
      --bg: #f8fafc;
      --primary: #3b82f6; /* blue */
      --primary-700: #1d4ed8;
      --muted: #64748b;
      --card-bg: #ffffff;
      --glass: rgba(59, 130, 246, 0.06);
      --radius: 16px;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
      --shadow-hover: 0 8px 24px rgba(0,0,0,0.08);
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:#1e293b}
    header{
      background: linear-gradient(90deg, rgba(59,130,246,0.05), rgba(59,130,246,0.02));
      border-bottom: 1px solid rgba(59,130,246,0.06);
      padding: 18px 24px;
      display:flex;
      gap:16px;
      align-items:center;
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:48px; height:48px; border-radius:12px; background:var(--primary); color:white;
      display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow:var(--shadow);
      font-size:20px;
    }
    h1{font-size:18px;margin:0;color:var(--primary-700); font-weight:700}
    .subtitle{font-size:14px; color:var(--muted); margin-top:2px}
    .controls{margin-left:auto; display:flex; gap:12px; align-items:center;}
    .search{
      display:flex; gap:8px; align-items:center; background:#fff; border-radius:12px; padding:8px 12px;
      box-shadow:var(--shadow); border:1px solid rgba(0,0,0,0.04); transition: all 0.2s;
    }
    .search:focus-within{
      box-shadow: 0 0 0 2px rgba(59,130,246,0.2);
    }
    input[type="text"]{
      border:0; outline:none; font-size:14px; width:200px; background:transparent;
    }
    button{
      background:var(--primary); color:white; border:0; padding:10px 16px; border-radius:10px; cursor:pointer;
      font-weight:600; transition: all 0.2s; box-shadow: var(--shadow);
    }
    button:hover{
      background:var(--primary-700); transform: translateY(-1px); box-shadow: var(--shadow-hover);
    }
    button.ghost{background:transparent; color:var(--primary); border:1px solid rgba(59,130,246,0.12)}
    button.ghost:hover{background:rgba(59,130,246,0.06); transform: translateY(-1px);}
    main{padding:24px; max-width:1200px; margin:0 auto;}
    .meta{display:flex; gap:16px; align-items:center; margin-bottom:20px; flex-wrap:wrap;}
    .info{
      background:var(--card-bg); padding:12px 16px; border-radius:12px; display:flex; gap:8px; align-items:center;
      box-shadow:var(--shadow); font-size:14px;
    }

    /* grid of cards */
    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:20px;}
    .card{
      background: white; border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; 
      border:1px solid rgba(0,0,0,0.03); transition: all 0.3s; display:flex; flex-direction:column; gap:12px;
    }
    .card:hover{
      transform: translateY(-4px); box-shadow: var(--shadow-hover);
    }
    .card h3{margin:0; display:flex; justify-content:space-between; align-items:center; gap:8px; font-size:16px; color:var(--primary-700)}
    .card .rows{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:14px; color:#334155; line-height:1.5}
    .muted{color:var(--muted); font-size:14px}

    /* pagination */
    .pager{display:flex; gap:8px; justify-content:center; margin:24px 0; align-items:center;}
    .page-btn{background:transparent; border:1px solid rgba(0,0,0,0.08); padding:8px 12px; border-radius:8px; cursor:pointer; transition: all 0.2s}
    .page-btn:hover{background:rgba(59,130,246,0.06); border-color:rgba(59,130,246,0.2)}
    .page-btn.active{background:var(--primary); color:white; border-color:var(--primary)}

    /* calculator popup */
    .calc-toggle {display:flex; gap:8px; align-items:center}
    .calculator{
      position:fixed; right:24px; bottom:24px; width:340px; max-width:calc(100% - 48px);
      background:linear-gradient(180deg, #fff, #fff); border-radius:16px; box-shadow:0 20px 40px rgba(0,0,0,0.15);
      border:1px solid rgba(0,0,0,0.06); z-index:9999; user-select:none; overflow:hidden;
    }
    .calc-header{padding:12px 16px; display:flex; justify-content:space-between; align-items:center; cursor:grab; background:var(--primary); color:white}
    .calc-body{padding:16px}
    .calc-screen{background:var(--glass); padding:12px; border-radius:10px; min-height:52px; display:flex; flex-direction:column; justify-content:center; font-size:20px; text-align:right; font-family:monospace; margin-bottom:12px}
    .calc-row{display:flex; gap:10px; margin-top:10px}
    .btn{flex:1; padding:12px; border-radius:10px; border:0; background:#f1f5f9; cursor:pointer; font-weight:600; transition: all 0.2s}
    .btn:hover{background:#e2e8f0; transform: scale(1.02)}
    .btn.op{background:var(--primary); color:white}
    .btn.op:hover{background:var(--primary-700)}
    .toggle-mode{background:transparent; border:1px solid rgba(255,255,255,0.3); padding:6px 10px; border-radius:8px; cursor:pointer; color:white; transition: all 0.2s}
    .toggle-mode:hover{background:rgba(255,255,255,0.1)}

    /* small / responsive tweaks */
    @media (max-width:768px){
      .search input{width:140px}
      .grid{grid-template-columns: repeat(auto-fill, minmax(200px,1fr))}
      .calculator{width:94%; left:3%; right:3%}
      .brand h1{font-size:16px}
      header{padding:14px 16px;}
      main{padding:16px;}
    }

    footer{padding:24px; text-align:center; color:var(--muted); font-size:14px; background:var(--card-bg); margin-top:40px; border-radius:16px; box-shadow:var(--shadow)}
    a{color:var(--primary)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">×</div>
      <div>
        <h1>แม่สูตรคูณ 1–1000</h1>
        <div class="subtitle">ค้นหาและแสดงผลแม่สูตรคูณ พร้อมเครื่องคิดเลขวิทยาศาสตร์</div>
      </div>
    </div>

    <div class="controls" role="region" aria-label="controls">
      <div class="search" title="ค้นหาแม่ (เช่น 7 หรือ 10-15)">
        <input id="searchBox" type="text" placeholder="ค้นหาแม่ (เช่น 7 หรือ 10-15)" aria-label="ค้นหาแม่สูตรคูณ">
        <button id="searchBtn" class="ghost">ค้นหา</button>
      </div>
      <div class="calc-toggle">
        <button id="openCalcBtn">เครื่องคิดเลข</button>
      </div>
    </div>
  </header>

  <main>
    <div class="meta">
      <div class="info">ปัจจุบัน: <strong id="totalCount">1000</strong> แม่</div>
      <div class="info">แสดงต่อหน้า:
        <select id="perPageSelect" aria-label="จำนวนการ์ดต่อหน้า">
          <option>12</option>
          <option selected>24</option>
          <option>36</option>
          <option>48</option>
        </select>
      </div>
      <div class="info muted">พิมพ์ "all" เพื่อแสดงทั้งหมด</div>
    </div>

    <section id="results" class="grid" aria-live="polite"></section>

    <div class="pager" id="pager" role="navigation" aria-label="pagination"></div>

    <footer>
      ****
    </footer>
  </main>

  <!-- Calculator popup template (hidden initially) -->
  <div id="calculator" class="calculator" style="display:none;" role="dialog" aria-label="เครื่องคิดเลขวิทยาศาสตร์">
    <div class="calc-header" id="calcHeader">
      <div style="display:flex; gap:10px; align-items:center;">
        <strong>เครื่องคิดเลขวิทยาศาสตร์</strong>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="toggleMode" class="toggle-mode">Scientific</button>
        <button id="closeCalc" class="ghost" style="color:white; border-color:rgba(255,255,255,0.3)">✕</button>
      </div>
    </div>
    <div class="calc-body">
      <div id="screen" class="calc-screen" tabindex="0" aria-live="polite">0</div>
      <div style="margin-top:8px">
        <input id="exprInput" type="text" placeholder="พิมพ์นิพจน์ เช่น 2^10, sin(30), sqrt(25)" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,0.08); font-size:14px" />
      </div>
      <div id="buttonsArea" style="margin-top:12px;">
        <!-- buttons are created by JS for flexibility -->
      </div>
    </div>
  </div>

<script>
/* ============================================================
   MAIN APP LOGIC
   - Generate tables 1..1000 (but render page-by-page)
   - Search supports single number or range '10-15'
   - Pagination / per-page
   - Calculator popup (draggable) with safe evaluation
   ============================================================ */

(() => {
  // Config
  const MAX_MULTIPLIER = 1000;
  const DEFAULT_RANGE_END = 12; // show 1..12 by default
  const container = document.getElementById('results');
  const pager = document.getElementById('pager');
  const totalCountEl = document.getElementById('totalCount');
  const perPageSelect = document.getElementById('perPageSelect');
  const searchBox = document.getElementById('searchBox');
  const searchBtn = document.getElementById('searchBtn');

  let currentList = Array.from({length: MAX_MULTIPLIER}, (_,i)=>i+1); // current numbers to display
  let currentPage = 1;

  totalCountEl.textContent = MAX_MULTIPLIER;

  function renderPage(page=1){
    container.innerHTML = '';
    const perPage = Number(perPageSelect.value) || 24;
    const start = (page-1)*perPage;
    const end = Math.min(start+perPage, currentList.length);
    const slice = currentList.slice(start,end);
    
    // create cards for slice
    for(const n of slice){
      const card = document.createElement('article');
      card.className = 'card';
      
      const h3 = document.createElement('h3');
      h3.innerHTML = `<span>แม่ ${n}</span>`;
      card.appendChild(h3);

      const rows = document.createElement('div');
      rows.className = 'rows';
      // render multiplications 1..DEFAULT_RANGE_END
      const lines = [];
      for(let i=1;i<=DEFAULT_RANGE_END;i++){
        lines.push(`${n} × ${i} = ${n*i}`);
      }
      rows.innerHTML = lines.join('<br>');
      card.appendChild(rows);

      container.appendChild(card);
    }

    renderPager(page);
  }

  function renderPager(page=1){
    pager.innerHTML = '';
    const perPage = Number(perPageSelect.value) || 24;
    const totalPages = Math.max(1, Math.ceil(currentList.length / perPage));
    // show up to 7 page buttons with window
    const maxButtons = 7;
    let start = Math.max(1, page - Math.floor(maxButtons/2));
    let end = Math.min(totalPages, start + maxButtons -1);
    if(end - start < maxButtons -1){ start = Math.max(1, end - maxButtons +1); }
    
    // prev
    const prev = document.createElement('button'); 
    prev.className='page-btn'; 
    prev.textContent='‹ Prev';
    prev.disabled = page===1; 
    prev.addEventListener('click', ()=>{ 
      currentPage = Math.max(1,page-1); 
      renderPage(currentPage);
    });
    pager.appendChild(prev);
    
    for(let p=start;p<=end;p++){
      const btn = document.createElement('button');
      btn.className = 'page-btn' + (p===page? ' active' : '');
      btn.textContent = p;
      btn.addEventListener('click', ()=>{ 
        currentPage = p; 
        renderPage(p); 
      });
      pager.appendChild(btn);
    }
    
    const next = document.createElement('button'); 
    next.className='page-btn'; 
    next.textContent='Next ›';
    next.disabled = page===totalPages; 
    next.addEventListener('click', ()=>{ 
      currentPage = Math.min(totalPages,page+1); 
      renderPage(currentPage);
    });
    pager.appendChild(next);
    
    // small info
    const info = document.createElement('div'); 
    info.className='muted'; 
    info.style.marginLeft='12px';
    info.textContent = `หน้า ${page} / ${totalPages} (${currentList.length} แม่)`;
    pager.appendChild(info);
  }

  // Search parser: supports "7" or "10-15" or comma separated "3,5,10-12"
  function parseSearch(query){
    if(!query) return Array.from({length:MAX_MULTIPLIER},(_,i)=>i+1);
    query = query.trim();
    const parts = query.split(',').map(s=>s.trim()).filter(Boolean);
    const nums = new Set();
    for(const part of parts){
      const rangeMatch = part.match(/^(\d+)\s*-\s*(\d+)$/);
      if(rangeMatch){
        let a = Number(rangeMatch[1]), b = Number(rangeMatch[2]);
        if(a > b){ [a,b] = [b,a]; }
        a = Math.max(1, a); b = Math.min(MAX_MULTIPLIER, b);
        for(let i=a;i<=b;i++) nums.add(i);
        continue;
      }
      const single = Number(part);
      if(!Number.isNaN(single) && single>=1 && single<=MAX_MULTIPLIER){
        nums.add(single);
        continue;
      }
      // fallback: try fuzzy numeric extraction
      const numOnly = (part.match(/\d+/g)||[]).map(Number);
      for(const n of numOnly) if(n>=1 && n<=MAX_MULTIPLIER) nums.add(n);
    }
    return Array.from(nums).sort((a,b)=>a-b);
  }

  function applySearch(){
    const q = searchBox.value;
    const list = parseSearch(q);
    if(list.length === 0){
      // no results
      currentList = [];
    } else {
      currentList = list;
    }
    currentPage = 1;
    renderPage(1);
  }

  // Event bindings
  searchBtn.addEventListener('click', applySearch);
  searchBox.addEventListener('keydown', (e)=>{ if(e.key==='Enter') applySearch(); });
  perPageSelect.addEventListener('change', ()=>{ currentPage=1; renderPage(1); });

  // initial render (first page)
  renderPage(1);

  /* ============================================================
     CALCULATOR: popup, draggable, safe evaluation
     - Allowed: numbers, + - * / ^ ( ) . , spaces
     - Functions supported: sin, cos, tan (degrees), log (base10), ln, sqrt, exp, pow
     - Factorial via trailing '!' eg 5!
     - Implementation: transform expression to a controlled JS expression
     ============================================================ */

  const calcEl = document.getElementById('calculator');
  const openCalcBtn = document.getElementById('openCalcBtn');
  const closeCalc = document.getElementById('closeCalc');
  const toggleMode = document.getElementById('toggleMode');
  const screen = document.getElementById('screen');
  const exprInput = document.getElementById('exprInput');
  const buttonsArea = document.getElementById('buttonsArea');
  let scientific = true;

  function showCalc(){
    calcEl.style.display='block';
    exprInput.focus();
  }
  function hideCalc(){
    calcEl.style.display='none';
  }
  openCalcBtn.addEventListener('click', showCalc);
  closeCalc.addEventListener('click', hideCalc);
  toggleMode.addEventListener('click', ()=>{
    scientific = !scientific;
    toggleMode.textContent = scientific ? 'Scientific' : 'Basic';
    buildCalcButtons();
  });

  // Draggable
  (function makeDraggable(){
    const header = document.getElementById('calcHeader');
    let isDown=false, startX=0, startY=0, startLeft=0, startTop=0;
    header.addEventListener('mousedown', (e)=>{
      isDown=true;
      const rect = calcEl.getBoundingClientRect();
      startX = e.clientX; startY = e.clientY;
      startLeft = rect.left; startTop = rect.top;
      header.style.cursor='grabbing';
      e.preventDefault();
    });
    document.addEventListener('mousemove', (e)=>{
      if(!isDown) return;
      const dx = e.clientX - startX, dy = e.clientY - startY;
      calcEl.style.left = Math.max(8, startLeft + dx) + 'px';
      calcEl.style.top = Math.max(8, startTop + dy) + 'px';
      calcEl.style.right = 'auto';
      calcEl.style.bottom = 'auto';
    });
    document.addEventListener('mouseup', ()=>{ isDown=false; header.style.cursor='grab'; });
    // touch support
    header.addEventListener('touchstart', (e)=>{
      isDown=true;
      const t = e.touches[0];
      const rect = calcEl.getBoundingClientRect();
      startX = t.clientX; startY = t.clientY;
      startLeft = rect.left; startTop = rect.top;
    });
    document.addEventListener('touchmove', (e)=>{
      if(!isDown) return;
      const t = e.touches[0];
      const dx = t.clientX - startX, dy = t.clientY - startY;
      calcEl.style.left = Math.max(8, startLeft + dx) + 'px';
      calcEl.style.top = Math.max(8, startTop + dy) + 'px';
      calcEl.style.right = 'auto';
      calcEl.style.bottom = 'auto';
    });
    document.addEventListener('touchend', ()=>{ isDown=false; });
  })();

  // Build calculator buttons
  function buildCalcButtons(){
    buttonsArea.innerHTML = '';
    const basicBtns = [
      ['7','8','9','/'],
      ['4','5','6','*'],
      ['1','2','3','-'],
      ['0','.','(',')'],
      ['C','DEL','=','+']
    ];
    const sciBtns = [
      ['sin','cos','tan','^'],
      ['log','ln','sqrt','!'],
      ['exp','pow','pi','e']
    ];
    // create rows
    const fragment = document.createDocumentFragment();
    if(scientific){
      const row = document.createElement('div');
      row.className='calc-row';
      // add scientific first row grid (we'll add as grouped)
      sciBtns.forEach(group=>{
        const rowEl = document.createElement('div');
        rowEl.className='calc-row';
        group.forEach(label=>{
          const b = document.createElement('button'); b.className='btn';
          b.textContent = label;
          b.addEventListener('click', ()=> onCalcButton(label));
          rowEl.appendChild(b);
        });
        fragment.appendChild(rowEl);
      });
    }
    basicBtns.forEach(group=>{
      const rowEl = document.createElement('div');
      rowEl.className='calc-row';
      group.forEach(label=>{
        const b = document.createElement('button'); b.className='btn';
        if(['/','*','-','+','=','!','^'].includes(label)) b.classList.add('op');
        b.textContent = label;
        b.addEventListener('click', ()=> onCalcButton(label));
        rowEl.appendChild(b);
      });
      fragment.appendChild(rowEl);
    });

    buttonsArea.appendChild(fragment);
  }

  function onCalcButton(label){
    if(label === 'C'){ exprInput.value=''; screen.textContent='0'; exprInput.focus(); return; }
    if(label === 'DEL'){ exprInput.value = exprInput.value.slice(0,-1); exprInput.focus(); return; }
    if(label === '='){ evaluateExpression(); exprInput.focus(); return; }
    if(label === 'pi'){ exprInput.value += Math.PI.toFixed(8); exprInput.focus(); return; }
    if(label === 'e'){ exprInput.value += Math.E.toFixed(8); exprInput.focus(); return; }
    if(label === 'pow'){ exprInput.value += '^'; exprInput.focus(); return; }
    exprInput.value += label;
    exprInput.focus();
  }

  // keyboard bindings
  exprInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){ e.preventDefault(); evaluateExpression(); }
    if(e.key === 'Escape'){ hideCalc(); }
  });

  // Evaluate expression safely
  function evaluateExpression(){
    const raw = exprInput.value.trim();
    if(!raw){ screen.textContent='0'; return; }
    try{
      const val = safeEval(raw);
      screen.textContent = String(val);
    }catch(err){
      screen.textContent = 'Error';
      console.error('Calc error:', err);
    }
  }

  // Safe evaluator:
  // - allow digits, spaces, parentheses, operators + - * / ^ . , !
  // - allow function names from whitelist only
  // - replace ^ with ** for exponent, handle factorial (!) by replacing n! with fact(n)
  // - treat sin/cos/tan as degrees (sin(30) => Math.sin(30 * PI/180))
  function safeEval(input){
    // normalize common symbols
    let expr = input.replace(/×/g,'*').replace(/÷/g,'/').replace(/,/g,'.');
    // remove dangerous characters
    // allowed letters: a-z A-Z (for function names), digits, operators, parentheses, space, dot, exclamation
    if(/[^0-9+\-*/().\s^!a-zA-Z]/.test(expr)){
      throw new Error('Invalid characters in expression');
    }

    // whitelist of allowed function names
    const funcs = ['sin','cos','tan','log','ln','sqrt','exp','pow','abs','round','floor','ceil'];
    // replace factorial occurrences like 5! or (5+2)!
    expr = expr.replace(/(\d+|\([^()]*\))\s*!/g, (m,p1)=>`fact(${p1})`);

    // replace ^ with ** for exponent
    expr = expr.replace(/\^/g,'**');

    // Replace function names to our safe wrappers
    // We will create a function with these names as parameters
    // Validate that only allowed identifiers are present
    const identifiers = Array.from(new Set((expr.match(/[a-zA-Z_]\w*/g)||[])));
    for(const id of identifiers){
      if(!funcs.includes(id)){
        throw new Error('Invalid function: ' + id);
      }
    }

    // Build the function body and call it with our safe implementations
    // Provide wrappers: sin/cos/tan in degrees, log base10, ln natural log, sqrt, exp
    const wrappers = {
      sin: (x)=> Math.sin((Number(x) || 0) * Math.PI/180),
      cos: (x)=> Math.cos((Number(x) || 0) * Math.PI/180),
      tan: (x)=> Math.tan((Number(x) || 0) * Math.PI/180),
      log: (x)=> Math.log10(Number(x)),
      ln: (x)=> Math.log(Number(x)),
      sqrt: (x)=> Math.sqrt(Number(x)),
      exp: (x)=> Math.exp(Number(x)),
      pow: (a,b)=> Math.pow(Number(a), Number(b)),
      abs: (x)=> Math.abs(Number(x)),
      round: (x)=> Math.round(Number(x)),
      floor: (x)=> Math.floor(Number(x)),
      ceil: (x)=> Math.ceil(Number(x))
    };

    // factorial helper
    function fact(n){
      n = Math.floor(Number(n));
      if(n < 0) throw new Error('factorial negative');
      if(n > 170) throw new Error('factorial too large');
      let res = 1;
      for(let i=2;i<=n;i++) res *= i;
      return res;
    }

    // Create function arguments list and values corresponding
    const argNames = ['fact']; // always provide fact
    const argValues = [fact];
    // add wrappers in stable order
    for(const name of Object.keys(wrappers)){
      argNames.push(name);
      argValues.push(wrappers[name]);
    }
    // build function code safely (no access to window)
    const fuBody = `return (${expr});`;
    // Create new Function with whitelisted names as parameters
    const func = Function(...argNames, fuBody);
    // call it with values
    return func(...argValues);
  }

  // initial calc build
  buildCalcButtons();

  // small UX: show result update when typing
  let evalTimeout = null;
  exprInput.addEventListener('input', ()=>{
    if(evalTimeout) clearTimeout(evalTimeout);
    evalTimeout = setTimeout(()=>{
      try{
        const v = safeEval(exprInput.value);
        screen.textContent = String(v);
      }catch(e){
        screen.textContent = '...';
      }
    }, 300);
  });

  // allow pressing Enter from main page to search
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' && document.activeElement !== exprInput){
      applySearch();
    }
  });

  // Accessibility: focus screen shows value
  screen.addEventListener('focus', ()=> screen.textContent = screen.textContent);

  // provide helpful hint if user inputs 'all'
  searchBox.addEventListener('input', ()=>{
    if(searchBox.value.trim().toLowerCase() === 'all'){
      searchBox.value = '';
      applySearch();
    }
  });

})();
</script>
</body>
</html>